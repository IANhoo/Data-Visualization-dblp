data1 = [
    { "date": 1945, "page": 8 },
    { "date": 1954, "page": 157 },
    { "date": 1955, "page": 228 },
    { "date": 1956, "page": 306 },
    { "date": 1957, "page": 534 },
    { "date": 1958, "page": 807 },
    { "date": 1959, "page": 1182 },
    { "date": 1960, "page": 1344 },
    { "date": 1961, "page": 1402 },
    { "date": 1962, "page": 1319 },
    { "date": 1963, "page": 1613 },
    { "date": 1964, "page": 1643 },
    { "date": 1965, "page": 1778 },
    { "date": 1966, "page": 2533 },
    { "date": 1967, "page": 4206 },
    { "date": 1968, "page": 3677 },
    { "date": 1969, "page": 3820 },
    { "date": 1970, "page": 4418 },
    { "date": 1971, "page": 5664 },
    { "date": 1972, "page": 6425 },
    { "date": 1973, "page": 2217 },
    { "date": 1974, "page": 7977 },
    { "date": 1975, "page": 10884 },
    { "date": 1976, "page": 11803 },
    { "date": 1977, "page": 13918 },
    { "date": 1978, "page": 13703 },
    { "date": 1979, "page": 13678 },
    { "date": 1980, "page": 16343 },
    { "date": 1981, "page": 19006 },
    { "date": 1982, "page": 21356 },
    { "date": 1983, "page": 25889 },
    { "date": 1984, "page": 23686 },
    { "date": 1985, "page": 27808 },
    { "date": 1986, "page": 39271 },
    { "date": 1987, "page": 31648 },
    { "date": 1988, "page": 34786 },
    { "date": 1989, "page": 45387 },
    { "date": 1990, "page": 49675 },
    { "date": 1991, "page": 59238 },
    { "date": 1992, "page": 61963 },
    { "date": 1993, "page": 74928 },
    { "date": 1994, "page": 80754 },
    { "date": 1995, "page": 88228 },
    { "date": 1996, "page": 99391 },
    { "date": 1997, "page": 108462 },
    { "date": 1998, "page": 110207 },
    { "date": 1999, "page": 109447 },
    { "date": 2000, "page": 122106 },
    { "date": 2001, "page": 127743 },
    { "date": 2002, "page": 68772 },
    { "date": 2003, "page": 127 }];

data2 = [
    { "date": 1959, "page": 465.0 },
    { "date": 1960, "page": 116.0 },
    { "date": 1961, "page": 199.0 },
    { "date": 1962, "page": 916.0 },
    { "date": 1963, "page": 149.0 },
    { "date": 1964, "page": 245.0 },
    { "date": 1965, "page": 322.0 },
    { "date": 1966, "page": 298.0 },
    { "date": 1967, "page": 329.0 },
    { "date": 1968, "page": 2082.0 },
    { "date": 1969, "page": 1247.0 },
    { "date": 1970, "page": 840.0 },
    { "date": 1971, "page": 3523.0 },
    { "date": 1972, "page": 2110.0 },
    { "date": 1973, "page": 3245.0 },
    { "date": 1974, "page": 5860.0 },
    { "date": 1975, "page": 7405.0 },
    { "date": 1976, "page": 6269.0 },
    { "date": 1977, "page": 8086.0 },
    { "date": 1978, "page": 8904.0 },
    { "date": 1979, "page": 9923.0 },
    { "date": 1980, "page": 12089.0 },
    { "date": 1981, "page": 12786.0 },
    { "date": 1982, "page": 17505.0 },
    { "date": 1983, "page": 20018.0 },
    { "date": 1984, "page": 25304.0 },
    { "date": 1985, "page": 28767.0 },
    { "date": 1986, "page": 38449.0 },
    { "date": 1987, "page": 47424.0 },
    { "date": 1988, "page": 58292.0 },
    { "date": 1989, "page": 63543.0 },
    { "date": 1990, "page": 66944.0 },
    { "date": 1991, "page": 87948.0 },
    { "date": 1992, "page": 96153.0 },
    { "date": 1993, "page": 115002.0 },
    { "date": 1994, "page": 116315.0 },
    { "date": 1995, "page": 121871.0 },
    { "date": 1996, "page": 114136.0 },
    { "date": 1997, "page": 130218.0 },
    { "date": 1998, "page": 148275.0 },
    { "date": 1999, "page": 154308.0 },
    { "date": 2000, "page": 175030.0 },
    { "date": 2001, "page": 166319.0 },
    { "date": 2002, "page": 128621.0 },];

data3 = [
    { "date": 1983, "page": 252.0 },
    { "date": 1984, "page": 364.0 },
    { "date": 1985, "page": 873.0 },
    { "date": 1986, "page": 1588.0 },
    { "date": 1987, "page": 1199.0 },
    { "date": 1988, "page": 982.0 },
    { "date": 1989, "page": 574.0 },
    { "date": 1990, "page": 2527.0 },
    { "date": 1991, "page": 2051.0 },
    { "date": 1992, "page": 1787.0 },
    { "date": 1993, "page": 537.0 },
    { "date": 1995, "page": 2341.0 },
    { "date": 1996, "page": 2666.0 },
    { "date": 1997, "page": 3872.0 },
    { "date": 1998, "page": 362.0 },
    { "date": 1999, "page": 1128.0 },
    { "date": 2000, "page": 344.0 },
    { "date": 2001, "page": 3280.0 },
    { "date": 2002, "page": 334.0 },];
data4 = [
    { "date": 1945, "page": 8.0 },
    { "date": 1954, "page": 157.0 },
    { "date": 1955, "page": 228.0 },
    { "date": 1956, "page": 306.0 },
    { "date": 1957, "page": 534.0 },
    { "date": 1958, "page": 807.0 },
    { "date": 1959, "page": 1647.0 },
    { "date": 1960, "page": 1460.0 },
    { "date": 1961, "page": 1601.0 },
    { "date": 1962, "page": 2235.0 },
    { "date": 1963, "page": 1762.0 },
    { "date": 1964, "page": 1888.0 },
    { "date": 1965, "page": 2100.0 },
    { "date": 1966, "page": 2831.0 },
    { "date": 1967, "page": 4535.0 },
    { "date": 1968, "page": 5759.0 },
    { "date": 1969, "page": 5067.0 },
    { "date": 1970, "page": 5258.0 },
    { "date": 1971, "page": 9187.0 },
    { "date": 1972, "page": 8535.0 },
    { "date": 1973, "page": 5462.0 },
    { "date": 1974, "page": 13837.0 },
    { "date": 1975, "page": 18289.0 },
    { "date": 1976, "page": 18072.0 },
    { "date": 1977, "page": 22004.0 },
    { "date": 1978, "page": 22607.0 },
    { "date": 1979, "page": 23601.0 },
    { "date": 1980, "page": 28432.0 },
    { "date": 1981, "page": 31792.0 },
    { "date": 1982, "page": 38861.0 },
    { "date": 1983, "page": 46159.0 },
    { "date": 1984, "page": 49354.0 },
    { "date": 1985, "page": 57448.0 },
    { "date": 1986, "page": 79308.0 },
    { "date": 1987, "page": 80271.0 },
    { "date": 1988, "page": 94060.0 },
    { "date": 1989, "page": 109504.0 },
    { "date": 1990, "page": 119146.0 },
    { "date": 1991, "page": 149237.0 },
    { "date": 1992, "page": 159903.0 },
    { "date": 1993, "page": 190467.0 },
    { "date": 1994, "page": 197069.0 },
    { "date": 1995, "page": 212440.0 },
    { "date": 1996, "page": 216193.0 },
    { "date": 1997, "page": 242552.0 },
    { "date": 1998, "page": 258844.0 },
    { "date": 1999, "page": 264883.0 },
    { "date": 2000, "page": 297480.0 },
    { "date": 2001, "page": 297342.0 },
    { "date": 2002, "page": 197727.0 },
    { "date": 2003, "page": 127.0 },];

let format = d3.format(",");
//const el = $(container);
// set the dimensions and margins of the graph
var margin = { top: 30, right: 0, bottom: 20, left: 30 },
    width = 1300 - margin.left - margin.right,
    height = 450 - margin.top - margin.bottom;

// append the svg object to the body of the page
var svg = d3.select("#my_dataviz")
    .append("svg")
    .attr("width", width + margin.left + margin.right)
    .attr("height", height + margin.top + margin.bottom)
    .append("g")
    .attr("transform",
        "translate(" + margin.left + "," + margin.top + ")");

// Initialize the X axis
var x = d3.scaleBand()
    .range([0, width])
    .padding(0.1);
var xAxis = svg.append("g")
    .attr("transform", "translate(0," + height + ")")

// Initialize the Y axis
var y = d3.scaleLinear()
    .range([height, 0]);
var yAxis = svg.append("g")
    .attr("class", "myYaxis")


// A function that create / update the plot for a given variable:
function update(data) {

    // Update the X axis
    x.domain(data.map(function (d) { return d.date; }))
    xAxis.call(d3.axisBottom(x))

    // Update the Y axis
    y.domain([0, d3.max(data, function (d) { return d.page })]);
    yAxis.transition().duration(1000).call(d3.axisLeft(y));

    // Create the u variable
    var u = svg.selectAll("rect")
        .data(data)

    u
        .enter()
        .append("rect") // Add a new rect for each new elements
        .merge(u) // get the already existing elements as well
        .transition() // and apply changes to all of them
        .duration(1000)
        .attr("x", function (d) { return x(d.date); })
        .attr("y", function (d) { return y(d.page); })
        .attr("width", x.bandwidth())
        .attr("height", function (d) { return height - y(d.page); })
        .attr("fill", "steelblue")

    // If less date in the new dataset, I delete the ones not in use anymore
    u
        .exit()
        .remove()
}

// Initialize the plot with the first dataset
update(data1)